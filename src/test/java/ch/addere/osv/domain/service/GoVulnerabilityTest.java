package ch.addere.osv.domain.service;

import static java.nio.file.Files.readString;
import static org.assertj.core.api.Assertions.assertThat;

import java.io.IOException;
import java.nio.file.Path;
import org.junit.jupiter.api.Test;

class GoVulnerabilityTest {

  final static String GO_VULNERABILITY = "src/test/resources/go-vuln.json";

  @Test
  void testGoVulnerabilityExample() throws IOException {
    String jsonData = readJsonFile();
    String serialized = deserializeSerialize(jsonData);
    assertThat(serialized).isEqualTo(jsonData);
  }

  private static String deserializeSerialize(String jsonData) throws IOException {
    var deserialized = Deserializer.fromJson(jsonData);
    return Serializer.toJson(deserialized);
  }

  private static String readJsonFile() throws IOException {
    var fileName = Path.of(GO_VULNERABILITY);
    return normalizeJson(readString(fileName));
  }

  private static String normalizeJson(String json) {
    return json.replace("\n", "").replace(" ", "");
  }
}